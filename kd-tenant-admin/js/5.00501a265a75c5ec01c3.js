(window.webpackJsonp=window.webpackJsonp||[]).push([[5,68],{109:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),i=a(3),s=a(4),c=a(205),r=a(94),o=a(206),d=a(8),u=a(203),m=a.n(u),b=a(208);t.default=()=>{const e=Object(i.useParams)(),t=Object(b.a)(!1),[a,u]=Object(n.useState)(),[p]=s.Form.useForm(),{data:f}=Object(b.b)(()=>Object(d.yb)({shop_id:e.id,limit:300}).then(e=>e.data)),{tableProps:v,search:g,refresh:O,update:E,add:j}=Object(c.a)((t,a)=>d.pb(Object.assign(Object.assign({shop_id:e.id},t),a)).then(e=>({total:e.total,list:e.data})),{defaultPageSize:20,form:p}),{submit:h}=g||{},y=(e,t)=>{Object(d.qc)(e,t),E(e,t)},F=[{title:"id",dataIndex:"id",width:50},{title:"名称",key:"name",render:(e,t)=>{var a;return l.a.createElement("div",null,t.name,"  ",2===t.type&&l.a.createElement(s.Popover,{content:null===(a=t.discounts_goods)||void 0===a?void 0:a.map(e=>{var t,a;return l.a.createElement("div",null,null!==(a=null===(t=null==f?void 0:f.find(t=>t.id===e))||void 0===t?void 0:t.name)&&void 0!==a?a:e)}),title:"商品列表"},l.a.createElement(s.Tag,null,"关联的商品")),l.a.createElement("span",{style:{color:"#c00"}},(e=>{const t=m()(e).diff(m()(),"day");return t<0?"已过期":t<20?`还有${t}天过期`:""})(t.valid_end_time)))}},{title:"券类型",key:"type",width:100,render:(e,t)=>1===t.type?"满减券":"折扣券"},{title:"券状态",key:"status",width:100,render:(e,t)=>1===t.status?"使用中":"未生效"},{title:"已消费",dataIndex:"use_count",width:100},{title:"有效期",key:"id",width:200,render:(e,t)=>l.a.createElement("div",null,m()(t.valid_start_time).format("YYYY-MM-DD")," 至 ",m()(t.valid_end_time).format("YYYY-MM-DD"))},{title:"创建时间",key:"create_time",width:130,render:e=>m()(e.create_time).format("YYYY-MM-DD HH:mm")},{title:"跟新人",width:130,dataIndex:"create_by"},{title:"跟新时间",key:"update_time",width:130,render:e=>m()(e.update_time).format("YYYY-MM-DD HH:mm")},{title:"跟新人",width:130,dataIndex:"update_by"},{title:"操作",key:"action",fixed:"right",width:150,render:e=>l.a.createElement("div",null,0===e.status&&l.a.createElement(s.Button,{onClick:()=>y(e.id,{status:1}),type:"link"},"上架"),1===e.status&&l.a.createElement(s.Button,{onClick:()=>y(e.id,{status:0}),type:"link"},"下架"),l.a.createElement(s.Button,{onClick:()=>(u(e),void t.toggle()),type:"link"},"编辑"))}];return l.a.createElement("div",null,l.a.createElement(o.a,{space:!0,visible:!1},l.a.createElement(s.Form,{form:p,layout:"inline"},l.a.createElement(s.Form.Item,{name:"status"},l.a.createElement(s.Select,{placeholder:"状态",style:{width:"140px"},allowClear:!0,onChange:h},l.a.createElement(s.Select.Option,{value:"0"},"未生效"),l.a.createElement(s.Select.Option,{value:"1"},"已使用"))),l.a.createElement(s.Form.Item,{name:"name"},l.a.createElement(s.Input.Search,{placeholder:"名字",onSearch:h}))),l.a.createElement("div",null,l.a.createElement(s.Button,{type:"primary",onClick:()=>{u(void 0),t.toggle()}},"新增"),"  ",l.a.createElement(s.Button,{onClick:O},"刷新"))),l.a.createElement(s.Table,Object.assign({size:"small",columns:F,rowKey:"id",scroll:{x:1500}},v)),l.a.createElement(r.default,{id:parseInt(e.id),visible:t.state,data:a,setVisible:t.toggle,onOk:(e,t)=>{console.log(t),"update"===e?E(t.id,t):j(t)}}))}},202:function(e,t,a){(t=a(15)(!1)).push([e.i,"/** @format */\n.toolsBar {\n  background: #fff;\n  padding-bottom: 15px;\n}\n.toolsBar.toolsBar_space {\n  padding: 12px;\n}\n.toolsBar .toolsBar-content {\n  padding: 10px;\n  background: #f4f4f4;\n  margin-top: 5px;\n}\n",""]),e.exports=t},203:function(e,t,a){e.exports=a(6)(3e3)},205:function(e,t,a){"use strict";var n=a(5),l=a(214),i=a(1);t.a=function(e,t){var a;const{form:s}=t,c=Object(n.b)(t,["form"]),r=Object(l.a)(e,Object.assign(Object.assign({},c),{paginated:!0,manual:!0})),{params:o,run:d,mutate:u}=r,m=o[2]||{},[b,p]=Object(i.useState)(m.type||"simple"),[f,v]=Object(i.useState)(m.allFormData||{}),g=Object(i.useCallback)(()=>{if(s.getFieldInstance){const e=s.getFieldsValue(),t={};return Object.keys(e).forEach(a=>{s.getFieldInstance&&!s.getFieldInstance(a)||(t[a]=e[a])}),t}return s.getFieldsValue(null,()=>!0)},[s]);Object(i.useEffect)(()=>{if(s.getFieldInstance){const e={};Object.keys(f).forEach(t=>{s.getFieldInstance&&!s.getFieldInstance(t)||(e[t]=f[t])}),s.setFieldsValue(e)}else s.setFieldsValue(f)},[b]),Object(i.useEffect)(()=>{o.length>0?d(...o):t.manual||E()},[]);const O=Object(i.useCallback)(()=>{const e=g();v(Object.assign(Object.assign({},f),e)),p("simple"===b?"advance":"simple")},[b,f,g]),E=Object(i.useCallback)(e=>{(null==e?void 0:e.preventDefault)&&e.preventDefault(),setTimeout(()=>{const e=g();console.log(1111,e);const t=Object.assign(Object.assign({},f),e);v(t),d(Object.assign(Object.assign({},o[0]||{}),{current:1}),e,{allFormData:t,type:b})})},[g,d,o,f,b]),j=Object(i.useCallback)(()=>{s.resetFields(),E()},[s,E]);return Object.assign(Object.assign({},r),{search:{submit:E,type:b,changeType:O,reset:j},remove:e=>{u(t=>{const a=t.list.slice();return a.forEach((t,n)=>{t.id===e&&a.splice(n,1)}),Object.assign(Object.assign({},t),{list:a})})},add:e=>{u(t=>{const a=t.list.slice();return a.push(e),Object.assign(Object.assign({},t),{list:a})})},update:(e,t)=>{u(a=>{const n=a.list.slice();return n.forEach((a,l)=>{a.id===e&&(n[l]=Object.assign(Object.assign({},a),t))}),Object.assign(Object.assign({},a),{list:n})})},dataSource:(null===(a=r.data)||void 0===a?void 0:a.list)||[]})}},206:function(e,t,a){"use strict";var n=a(1),l=a.n(n),i=a(21),s=a.n(i);a(207);const c=({visible:e,content:t,space:a,children:n})=>l.a.createElement("div",{className:s()({toolsBar_space:a},"toolsBar")},l.a.createElement("div",{className:"flex flex_between"},n),l.a.createElement("div",{style:{display:e?"block":"none"},className:"toolsBar-content"},t));c.defaultProps={visible:!1,space:!1},t.a=c},207:function(e,t,a){var n=a(14),l=a(202);"string"==typeof(l=l.__esModule?l.default:l)&&(l=[[e.i,l,""]]);var i={insert:"head",singleton:!1},s=n(l,i);if(!l.locals||e.hot.invalidate){var c=l.locals;e.hot.accept(202,(function(){"string"==typeof(l=(l=a(202)).__esModule?l.default:l)&&(l=[[e.i,l,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var a;for(a in e)if(e[a]!==t[a])return!1;for(a in t)if(!e[a])return!1;return!0}(c,l.locals)?(c=l.locals,s(l)):e.hot.invalidate()}))}e.hot.dispose((function(){s()})),e.exports=l.locals||{}},209:function(e,t,a){e.exports=a(6)(408)},211:function(e,t,a){e.exports=a(6)(75)},287:function(e,t,a){e.exports=a(6)(4)},94:function(e,t,a){"use strict";a.r(t);var n=a(5),l=a(1),i=a.n(l),s=a(4),c=a(8),r=a(287),o=a.n(r),d=a(208);const{RangePicker:u}=s.DatePicker,m={labelCol:{flex:"140px"}};t.default=e=>{var{data:t}=e,a=Object(n.b)(e,["data"]);const[r,b]=Object(l.useState)(!1),[p,f]=Object(l.useState)(1),[v]=s.Form.useForm(),{data:g,run:O}=Object(d.b)(()=>Object(c.yb)({shop_id:a.id,limit:300}).then(e=>e.data),{manual:!0});Object(l.useEffect)(()=>{2!==p||g||O()},[p,g]),Object(l.useEffect)(()=>{a.visible&&setTimeout(()=>{t?(v.setFieldsValue(Object.assign(Object.assign({},t),{valid_time:[o()(t.valid_start_time,"YYYY-MM-DD"),o()(t.valid_end_time,"YYYY-MM-DD")]})),b(!0)):(b(!1),v.resetFields(),v.setFieldsValue({status:0,sort:1,type:1,name:"满XX减XX"}))})},[a.visible]);const E=Object(l.useCallback)(()=>{const e=v.getFieldValue("amount"),t=v.getFieldValue("discounts_amount");v.setFieldsValue({name:`满${e||"XX"}减${t||"XX"}`})},[v]),j=Object(l.useCallback)(()=>{const e=v.getFieldValue("discounts");v.setFieldsValue({name:`${e||"XX"}折折扣券`})},[v]);return i.a.createElement(s.Modal,{title:(null==t?void 0:t.id)?"编辑":"添加",maskClosable:!1,visible:a.visible,onCancel:()=>a.setVisible(),onOk:e=>{e.preventDefault(),v.validateFields().then(e=>Object(n.a)(void 0,void 0,void 0,(function*(){var n;e.valid_start_time=e.valid_time[0].format("YYYY-MM-DD"),e.valid_end_time=e.valid_time[1].format("YYYY-MM-DD");const l=Object.assign(Object.assign({},t),e);if(null==t?void 0:t.id)yield c.qc(t.id,e);else{const t=yield c.u(Object.assign(Object.assign({},e),{shop_id:a.id}));l.id=t.data}a.setVisible(),null===(n=a.onOk)||void 0===n||n.call(a,(null==t?void 0:t.id)?"update":"create",l)})))}},i.a.createElement(s.Form,Object.assign({form:v},m),i.a.createElement(s.Form.Item,{label:"券类型",name:"type",rules:[{required:!0}]},i.a.createElement(s.Select,{disabled:r,onChange:e=>{f(e),1===e?E():j()}},i.a.createElement(s.Select.Option,{value:1},"满减券"),i.a.createElement(s.Select.Option,{value:2},"折扣券"))),i.a.createElement(s.Form.Item,{label:"标题",name:"name",rules:[{required:!0}]},i.a.createElement(s.Input,{disabled:!0})),1===p&&i.a.createElement(i.a.Fragment,null,i.a.createElement(s.Form.Item,{label:"最小交易金额",name:"amount",rules:[{required:!0}]},i.a.createElement(s.InputNumber,{max:1e3,onChange:E,disabled:r})),i.a.createElement(s.Form.Item,{label:"优惠金额",name:"discounts_amount",rules:[{required:!0}]},i.a.createElement(s.InputNumber,{max:1e3,onChange:E,disabled:r}))),2===p&&i.a.createElement(i.a.Fragment,null,i.a.createElement(s.Form.Item,{label:"折扣",name:"discounts",rules:[{required:!0}]},i.a.createElement(s.InputNumber,{max:9.9,onChange:j,disabled:r})),i.a.createElement(s.Form.Item,{label:"商品",name:"discounts_goods",rules:[{required:!0}]},i.a.createElement(s.Select,{mode:"multiple",style:{width:"100%"},placeholder:"Please select"},null==g?void 0:g.map(e=>i.a.createElement(s.Select.Option,{key:e.id,value:e.id},e.name))))),i.a.createElement(s.Form.Item,{label:"有效期",name:"valid_time",rules:[{required:!0}]},i.a.createElement(u,{format:"YYYY-MM-DD"})),i.a.createElement(s.Form.Item,{label:"排序",name:"sort"},i.a.createElement(s.InputNumber,{max:1e4}))))}}}]);